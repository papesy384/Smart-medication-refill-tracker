<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Smart Medication & Refill Tracker</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="./css/styles.css" />
<!-- Supabase client (local to avoid Tracking Prevention blocking CDN) -->
<script src="./js/supabase.min.js"></script>
<script src="./js/config.js"></script>
</head>
  <body>
    <div class="app-shell">
      <header class="app-header">
        <div>
          <p class="eyebrow">Smart Medication & Refill Tracker</p>
          <h1>Stay on track, every dose.</h1>
          <p class="subtitle">
            A zero-search dashboard with clear, color-coded status.
          </p>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" id="toggleHighVisibility" title="Toggle large text and oversized buttons">
            <span id="highVisibilityLabel">Compact view</span>
          </button>
          <button class="btn btn-secondary" id="enableReminders">
            Enable reminders
          </button>
          <button class="btn btn-primary" id="addMedication">
            Add Medication
          </button>
        </div>
      </header>

      <div class="reminder-banner" id="reminderBanner" aria-live="polite" aria-hidden="true"></div>

      <main>
        <section class="dashboard">
          <div class="card card--hero" aria-label="Next dose - most important">
            <p class="label">Next Dose</p>
            <p class="value" id="nextDoseValue">--</p>
            <p class="hint" id="nextDoseHint">--</p>
          </div>
          <div class="card">
            <p class="label">Pending Doses</p>
            <p class="value" id="pendingDoseValue">--</p>
            <p class="hint">Within current time window</p>
          </div>
          <div class="card">
            <p class="label">Low Inventory</p>
            <p class="value" id="lowInventoryValue">--</p>
            <p class="hint">Refill soon</p>
          </div>
          <div class="card">
            <p class="label">Rx Expiring</p>
            <p class="value" id="expiringValue">--</p>
            <p class="hint">Within 30 days</p>
          </div>
        </section>

        <section class="panel">
          <div class="panel-header">
            <h2>Medication Status</h2>
            <div class="filter-group" role="group" aria-label="Filter">
              <button class="chip is-active" data-filter="all">All</button>
              <button class="chip" data-filter="pending">Due Now</button>
              <button class="chip" data-filter="missed">Missed</button>
              <button class="chip" data-filter="low">Low Stock</button>
              <button class="chip" data-filter="expiring">Expiring</button>
            </div>
          </div>
          <div class="med-list" id="medList"></div>
        </section>

        <section class="panel">
          <div class="panel-header">
            <h2>Upcoming Reminders</h2>
            <p class="panel-subtitle">Next 24 hours</p>
          </div>
          <div class="reminders" id="reminders"></div>
        </section>
      </main>

      <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

      <footer class="app-footer">
        <p>
          Status colors: <span class="status-dot green"></span> Green = clear,
          <span class="status-dot yellow"></span> Yellow = pending,
          <span class="status-dot red"></span> Red = urgent.
        </p>
        <p>
          <button type="button" class="btn-link" id="openCaregiverInfo">For caregivers</button>
          ·
          <button type="button" class="btn-link" id="openFeedback">Send feedback</button>
        </p>
      </footer>
    </div>

    <div class="modal-overlay" id="feedbackModal" aria-hidden="true">
      <div class="modal modal--small" role="dialog" aria-labelledby="feedbackTitle" aria-modal="true">
        <div class="modal-header">
          <h2 id="feedbackTitle">Send feedback</h2>
          <button type="button" class="modal-close" id="closeFeedbackModal" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
          <p class="caregiver-intro">Your feedback helps us improve. Tell us what works or what to improve.</p>
          <label for="feedbackText">Your message (optional)</label>
          <textarea id="feedbackText" rows="4" placeholder="e.g. Feature request, bug report, or general feedback…"></textarea>
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancelFeedback">Cancel</button>
            <button type="button" class="btn btn-primary" id="copyFeedback">Send feedback</button>
          </div>
          <p class="hint" id="feedbackHint"></p>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="caregiverModal" aria-hidden="true">
      <div class="modal modal--small" role="dialog" aria-labelledby="caregiverTitle" aria-modal="true">
        <div class="modal-header">
          <h2 id="caregiverTitle">For caregivers</h2>
          <button type="button" class="modal-close" id="closeCaregiverModal" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
          <p class="caregiver-intro">Caregivers can use this app when with the patient to see medication status, next doses, and low stock or expiring meds. Copy the status summary below to share by email or message.</p>
          <button type="button" class="btn btn-primary" id="copyCaregiverSummary">Copy status summary</button>
          <p class="hint" id="caregiverCopyHint"></p>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="addMedModal" aria-hidden="true">
      <div class="modal" role="dialog" aria-labelledby="addMedTitle" aria-modal="true">
        <div class="modal-header">
          <h2 id="addMedTitle">Add Medication</h2>
          <button type="button" class="modal-close" id="closeAddMed" aria-label="Close">&times;</button>
        </div>
        <form id="addMedForm" class="modal-body">
          <div class="barcode-section" id="addMedBarcodeSection">
            <p class="barcode-label">Add by scanning or entering barcode (NDC)</p>
            <button type="button" class="btn btn-primary btn-scan-camera" id="scanWithCamera">
              Scan barcode with camera
            </button>
            <p class="barcode-or">or enter barcode / NDC:</p>
            <div class="barcode-row">
              <input type="text" id="medBarcode" name="barcode" placeholder="Type or use handheld scanner here" autocomplete="off" />
              <button type="button" class="btn btn-secondary" id="barcodeLookup">Look up</button>
            </div>
            <p class="barcode-hint" id="barcodeHint"></p>
          </div>
          <hr class="form-divider" aria-hidden="true" />

          <label for="medName">Medication name</label>
          <input type="text" id="medName" name="name" required placeholder="e.g. Lisinopril" />

          <label for="medDosage">Dosage</label>
          <input type="text" id="medDosage" name="dosage" required placeholder="e.g. 10 mg" />

          <div class="form-field--prominent" aria-describedby="medImageUrlHint">
            <label for="medImageUrl">Image URL <span class="label-optional">(optional)</span></label>
            <input type="url" id="medImageUrl" name="imageUrl" placeholder="https://… Paste a link to a photo of the medication" />
            <p class="hint" id="medImageUrlHint">Add a photo URL so you can recognize your medication at a glance on the dashboard.</p>
          </div>

          <label for="medSchedule">Dose times (24h, comma-separated)</label>
          <input type="text" id="medSchedule" name="schedule" required placeholder="e.g. 08:00, 14:00, 20:00" />

          <label for="medStock">Current stock (number of doses)</label>
          <input type="number" id="medStock" name="stock" required min="1" value="30" />

          <label for="medRefillThreshold">Refill when stock is at or below</label>
          <input type="number" id="medRefillThreshold" name="refillThreshold" required min="0" value="7" />

          <label for="medExpiresOn">Expires on</label>
          <input type="date" id="medExpiresOn" name="expiresOn" required />

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancelAddMed">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Medication</button>
          </div>
        </form>
      </div>
    </div>

    <div class="scan-overlay" id="scanOverlay" aria-hidden="true">
      <div class="scan-overlay-inner">
        <p class="scan-instruction">Point your camera at the barcode on the medicine container</p>
        <video id="scanVideo" playsinline muted></video>
        <p class="scan-status" id="scanStatus">Starting camera…</p>
        <button type="button" class="btn btn-secondary" id="cancelScan">Cancel</button>
      </div>
    </div>

    <div class="modal-overlay" id="updateStockModal" aria-hidden="true">
      <div class="modal modal--small" role="dialog" aria-labelledby="updateStockTitle" aria-modal="true">
        <div class="modal-header">
          <h2 id="updateStockTitle">Update stock</h2>
          <button type="button" class="modal-close" id="closeUpdateStock" aria-label="Close">&times;</button>
        </div>
        <div class="modal-body">
          <label for="updateStockInput">Stock (number of doses)</label>
          <input type="number" id="updateStockInput" min="0" value="0" />
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancelUpdateStock">Cancel</button>
            <button type="button" class="btn btn-primary" id="saveUpdateStock">Save</button>
          </div>
        </div>
      </div>
    </div>

    <script src="./js/app.js"></script>
  </body>
</html>
